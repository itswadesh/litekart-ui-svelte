var ns={high:"http://schemaapp.com/ontology/highlight#",schema:"http://schema.org/",rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",gist:"http://ontologies.semanticarts.com/gist#",rdfs:"http://www.w3.org/2000/01/rdf-schema#"};var sa={reserved_words:{baseURL:function(){return window.location.origin},currentURL:function(){return window.location.href},accountId:schemaAppgetAccountId}};var applicableTemplates=[];var config=null;var schemaServer="https://cdn.schemaapp.com";var schemaCDN="https://data.schemaapp.com/";var ytServer="https://api.hunchmanifest.com";var LOCAL_STORAGE_KEY=location.host+"-schemaapp";var TEXT_NODE=3;var API_KEY_FIELD="X-API-KEY";var ANALYTICS_ENDPOINT="https://0yl6pcjbij.execute-api.us-east-1.amazonaws.com/prod";var ANALYTICS_KEY="BiQcqdttWn7eunp8jvxM5oZl3DIx08J42LtTmaaj";var externalResources=[];var schemaAppMutationObserverConfig={attributes:false,childList:true,subtree:true,characterData:false};var schemaAppMutationObserver=null;var deployedTemplates={};var dirtyTemplates=[];var nodesTemplates={};var schemaAppLastRefresh=null;function saDocReady(a){if(document.readyState==="complete"||document.readyState==="interactive"){setTimeout(a,1)}else{document.addEventListener("DOMContentLoaded",a)}}function attemptReapplyTemplates(){if(schemaAppMutationObserver===null){return}var a=Date.now();if(schemaAppLastRefresh!=null){var c=a-schemaAppLastRefresh;if(c<500){return}}schemaAppLastRefresh=a;for(var b=0;b<applicableTemplates.length;b++){if(dirtyTemplates.indexOf(applicableTemplates[b])===-1){dirtyTemplates.push(applicableTemplates[b])}}loadTemplates(dirtyTemplates)}var schemaAppMutationObserver=function(b,a){attemptReapplyTemplates()};function schemaAppMutationDisable(){if(typeof schemaAppMutationObserver.disconnect==="function"){countPageForAnalytics();schemaAppMutationObserver.disconnect()}schemaAppMutationObserver=null}function applyContentFilter(a,c){if(typeof a!=="string"){return a}var e=a.trim();var b=[];if(c){var d=c.split('");');d.splice(d.length-1,1);d.forEach(function(g){var f={optionSelected:null,filterText:""};var h=g.split('("');f.optionSelected=h[0];if(h[1]){f.filterText=h[1]}b.push(f)})}b.forEach(function(g){if(e==null){return a}var n=e.toLowerCase();var l=g.filterText.toLowerCase();switch(g.optionSelected){case"BEFORE":if(g.filterText){var m=n.indexOf(l);if(m>=0){e=e.slice(0,m)}else{e=""}}break;case"AFTER":if(g.filterText){var m=n.indexOf(l);if(m>=0){e=e.slice(m+l.length)}else{e=""}}break;case"OMIT":e=e.split(g.filterText).join("");break;case"NUMBER":var j=a;var h=document.createElement("div");h.innerHTML=j;a=h.innerText;var i=/(\+|-)*((\d+[.]\d*)|(\d*[.]\d+)|\d+)/mi;var f=new RegExp(i);var k=f.exec(e);k?e=k[0]:e=null;break;case"NONNUMBER":e=e.replace(/\d+/gm,"");break}});return e?e:a}function insertInto(f,g,c){if(g==null||g.length===0){return}var l=f.split("~");var b=c;var k=l.length>1?l.slice(0,-1):l;var h=c["@id"]+"_"+k.join("_");for(var e=1;e<=l.length;e++){var m=l[e-1];if(e%2===0){if(b.length==0){b.push({"@type":m,"@id":h});b=b[0];continue}if(b[0]["@type"]===undefined){b[0]["@type"]=m;b=b[0];continue}var a=false;for(var d=0;d<b.length;d++){if(b[d]["@type"]==m){b=b[d];a=true;break}}if(a==false){b.push({"@type":m,"@id":window.location.href+"#"+m});b=b[b.length-1]}}else{if(e===l.length){if(b[m]!==undefined&&b[m].constructor==Array){b[m]=b[m].concat(g)}else{b[m]=g}}else{if(b[m]===undefined){b[m]=[]}}b=b[m]}}}function hasLocalStorage(a){try{var c=window[a];c.setItem("test","test");c.removeItem("test")}catch(b){return false}return true}function injectJSON(c,b){var a=deployedTemplates[b];if(a==null||a==undefined){var a=document.createElement("script");a.type="application/ld+json";document.getElementsByTagName("head")[0].appendChild(a);deployedTemplates[b]=a}a.innerHTML=c}function persistToLocalStorage(a){if(hasLocalStorage("sessionStorage")){window.sessionStorage.setItem(LOCAL_STORAGE_KEY,JSON.stringify(a))}}var schemaAppgetAccountId=function(){var b=getEntityByType(config,"Organization",ns.gist).pop();var a=getObjects(config,b,ns.gist+"describedIn").pop();if(a==null){return null}return a.replace("http://schemaapp.com/db/","")};function countPageForAnalytics(){var a=window.location.origin+window.location.pathname;var h=schemaAppgetAccountId();if(h===null){return}var j=h.split("/");var d=[];try{for(var b in deployedTemplates){var i=deployedTemplates[b].innerHTML;var c=b.replace("http://schemaapp.com/db/","");c=c.replace("http://schemaapp.com/resources/admin/Company_","");d.push(i)}if(d.length==1){d=d[0]}for(var b in deployedTemplates){if(b.indexOf("https://data.schemaapp.com")!=-1){continue}var f={AccountId:j[0],SubAccount:j[1]!==undefined?j[1]:"",DateSeen:"2019-11-25",Source:"HighlightJS:"+b,Domain:window.location.origin,URL:a,Json:d};var l=new XMLHttpRequest();l.open("POST",ANALYTICS_ENDPOINT,true);l.setRequestHeader(API_KEY_FIELD,ANALYTICS_KEY);l.setRequestHeader("content-type","application/json");var k=JSON.stringify(f);l.send(k)}}catch(g){}}function schemaAppLoadResources(){var c=window.location.protocol+"//"+window.location.host;var b=btoa(unescape(c)).replace(/=/g,"");var a=schemaServer+"/highlighter/prod/"+b;var d=new XMLHttpRequest();d.onreadystatechange=function(){if(this.readyState==4&&this.status==200){config=JSON.parse(d.responseText);saDocReady(processConfig);persistToLocalStorage(config)}};d.open("GET",a,true);d.send()}function processConfig(){var b=getEntityByType(config,"HighlightTemplate");var a=[location.protocol,"//",location.host,location.pathname].join("");b.forEach(function(v){var n=true;var m=config[v];if(m[ns.high+"pattern"]===undefined){return}for(var s=0;s<m[ns.high+"pattern"].length;s++){var c=m[ns.high+"pattern"][s];var t=config[c.value];var q=t[ns.gist+"categorizedBy"];var u=t[ns.gist+"hasMember"];for(var r=0;r<u.length;r++){var g=q[0];var p=g.value.replace(ns.high,"");var h=t[ns.gist+"hasMember"][r];var l=h.value;if(p==="GlobCollection"){if(globChecker(a,l)){n=false}}else{if(p==="XPathCollection"){var w=document.evaluate(l,document);if(w.resultType===3&&w.booleanValue){n=false;continue}if(w.resultType==4){var e=document.evaluate(l,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE);if(e.snapshotLength>0){n=false}}}else{if(l.toLowerCase().trim()==a.toLowerCase()){n=false}}}}}if(!n){var f="";if(m[ns.rdfs+"label"]!==undefined){var k=m[ns.rdfs+"label"].pop();if(k!==undefined){f=k.value}}var o=false;for(var s=0;s<applicableTemplates.length;s++){var d=applicableTemplates[s];if(d==v){o=true}}if(o===false){console.log("Pushing Template ("+f+") with uri: "+v);applicableTemplates.push(v)}}});if(applicableTemplates.length>0){loadTemplates(applicableTemplates,true)}}function processHighlights(j,c){var a=[];for(var e=0;e<j.length;e++){var g=j[e];var b=getObjects(config,g,ns.rdf+"type");var d=config[g];if(d==undefined){return}var m=tagFactory(b[0],d);var l=m[0];var f=l[ns.high+"propertyPath"][0].value;var k=Tag.extract(m,document,c);if(k!=null&&k.constructor===Array){a.push(k[1]);k=k[0]}insertInto(f,k,c)}return a}function processListTagHighlights(l,f,p,d){if(p==undefined||p[ns.high+"xPath"]==undefined){return}var e=p[ns.high+"xPath"][0]["value"];var k=[];var g=p[ns.high+"propertyPath"][0]["value"].split("~");var n=p[ns.high+"propertyPath"][0]["value"];var m=undefined;var o=n;if(g.length>1){m=g.pop();o=g.join("~")}var a=document.evaluate(e,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE);if(a.snapshotLength==0){window.setTimeout(function(){attemptReapplyTemplates()},100)}for(var j=0;j<a.snapshotLength;j++){var h=a.snapshotItem(j);if(m){var c={"@type":m,"@id":window.location.href+"#"+m.replace("http://schema.org/","")+"_"+d};if(m==="ListItem"){c.position=j}}l.forEach(function(y){var t=getObjects(config,y,ns.rdf+"type");var w=config[y];var z=null;var B=tagFactory(t[0],w);var A=B[0];if(w[ns.rdf+"type"][0]["value"]===ns.high+"TagXPath"){if(!w[ns.high+"xPath"]){z="text()";w[ns.high+"xPath"]=[{value:z}]}else{z=w[ns.high+"xPath"][0]["value"]}if(z.indexOf("|")===-1&&z.indexOf("(")===0){z=z.slice(2,-1)}else{if(z!="text()"){var s=z.replace(/^\(|\)$/gm,"").trim().split("|");var r=[];for(var v=0;v<s.length;v++){var q=s[v].trim();if(q.indexOf("//")===0){q=q.slice(2)}if(q.indexOf("/")===0){q=q.slice(1)}r.push(q)}z="( "+r.join(" | ")+" )"}}if(z.indexOf("//")===0){w[ns.high+"xPath"][0]["value"]=z.slice(2)}else{if(z.indexOf("contains")===-1){w[ns.high+"xPath"][0]["value"]=z.indexOf("/")==0?z.slice(1):z}else{w[ns.high+"xPath"][0]["value"]=z}}if(z===""){w[ns.high+"xPath"][0]["value"]="."}}var B=tagFactory(t[0],w);var A=B[0];var x="";if(A[ns.high+"propertyPath"]===undefined){x=n}else{x=A[ns.high+"propertyPath"][0].value}if(A[ns.high+"useDocumentContext"]&&A[ns.high+"useDocumentContext"][0].value==="true"){var u=Tag.extract(B)}else{var u=Tag.extract(B,h,c)}if(u!=null&&u.constructor===Array){u=u[0]}if(m){insertInto(x,u,c)}else{c=u}});d++;k.push(c)}insertInto(o,k,f);var b=null;if(a.snapshotLength>0){b=a.snapshotItem(0).parentNode.parentNode}return{resource:f,objectCount:a.snapshotLength,nodes:b}}function loadTemplates(v,b){var x=[];for(var n=0;n<v.length;n++){var y=v[n];try{var j=getObjects(config,y,ns.gist+"categorizedBy");var m={"@context":"http://schema.org/","@type":j,"@id":window.location.href+"#"+j[0].replace("http://schema.org/",""),url:window.location.href};var w=[];var a=[];var f=getObjects(config,y,ns.high+"hasHighlight");for(var c=0;c<f.length;c++){var s=f[c];var l=getObjects(config,s,ns.rdf+"type");if(l==ns.high+"TagList"){a.push(s)}else{w.push(s)}}var p=processHighlights(w,m);var o=0;for(var d=0;d<a.length;d++){var s=a[d];var g=config[s];var q=getObjects(config,s,ns.high+"hasTemplate");var f=getObjects(config,q,ns.high+"hasHighlight");res=processListTagHighlights(f,m,g,o);if(res){m=res.resource;o+=res.objectCount;p=p.concat(res.nodes)}}injectJSON(JSON.stringify(m),y);x.push(JSON.parse(JSON.stringify(m)));if(b){schemaAppMutationObserver=new MutationObserver(schemaAppMutationObserver);for(var r=0;r<p.length;r++){if(p[r]!=null){schemaAppMutationObserver.observe(p[r],schemaAppMutationObserverConfig)}}}}catch(u){}finally{var k=dirtyTemplates.indexOf(y);if(k>-1){dirtyTemplates.splice(k,1)}if(b){window.setTimeout(schemaAppMutationDisable,10000)}}}if(b){try{countPageForAnalytics(x,v)}catch(u){}}}function getObjects(b,c,a){var e=[];for(var d in b[c]){if(d===a){for(var f in b[c][d]){if(b[c][d][f].type==="uri"){e.push(b[c][d][f].value)}else{if(b[c][d][f].type==="literal"){e.push(b[c][d][f].value)}}}}}return e}function getEntityByType(a,c,e){if(e===undefined){e=ns.high}var f=[];for(var b in a){for(var d in a[b]){if(d===ns.rdf+"type"){if(a[b][d][0].value===(e+c)){f.push(b)}}}}return f}function tagFactory(b,a){if(b===(ns.high+"TagXPath")||b===(ns.high+"TagXPathDefined")){return Tag.construct(a,Tag.tagTypes.TagXPath)}else{if(b===(ns.high+"TagDefined")){return Tag.construct(a,Tag.tagTypes.TagDefined)}else{if(b===(ns.high+"TagStoredResource")){return Tag.construct(a,Tag.tagTypes.TagStoredResource)}else{if(b===(ns.high+"TagYouTube")){return Tag.construct(a,Tag.tagTypes.TagYouTube)}else{if(b===(ns.high+"TagLookup")){return Tag.construct(a,Tag.tagTypes.TagLookup)}}}}}throw new TypeError("Tag Factory unable to create class "+b)}var Utility={convertToNumeric:function(c){var a=c.trim();var b=Number(a);return(b===NaN||b.toString()==="NaN")?c:b},encodeHtmlEntities:function(b){var a=document.createElement("textarea");a.textContent=b;return a.innerHTML}};var Tag={tagTypes:Object.freeze({TagXPath:1,TagDefined:2,TagStoredResource:3,TagYouTube:4,TagLookup:5}),construct:function(a,b){return[a,[],b]},extract:function(b,a,d){var c=b[2];if(a===undefined){a=document}switch(c){case Tag.tagTypes.TagXPath:return Tag.xpathExtract(b,a);case Tag.tagTypes.TagDefined:return Tag.tagDefined(b);case Tag.tagTypes.TagStoredResource:return Tag.storedResource(b);case Tag.tagTypes.TagYouTube:return Tag.videoResource(b,a);case Tag.tagTypes.TagLookup:return Tag.tagLookup(b,a,d)}},getContentFromElement:function(e){if(e==undefined){return null}if(e.localName==undefined){return e.value}var c=e.localName.toLowerCase();if(c==="href"||c=="@href"){var b=document.createElement("a");b.href=e.textContent;return b.href}if(e.nodeType===TEXT_NODE){return e.wholeText}if(e.constructor===Attr){return e.value}var d=new Set(["img","video","audio","source","embed"]);var h=new Set(["meta"]);if(d.has(c)){if(e.hasAttribute("src")){var a=e.getAttribute("src");if(!a.startsWith("http")&&!a.startsWith("//")){a=window.location.protocol+"//"+window.location.host+a}else{if(a.startsWith("//")){a=window.location.protocol+a}}return a}else{return Tag.getContentFromElement(e.getElementsByTagName("source")[0])}}else{if(h.has(c)){var i=e.getAttribute("content");return i}}var f=e.cloneNode(true);removeScripts(f);var g=f.innerHTML;return g},tagDefined:function(b){var a=b[0];if(a[ns.high+"value"]){return a[ns.high+"value"][0].value}return null},videoResource:function(c,b){var d=c[0];var g=d[ns.high+"xPath"][0].value;var f=document.evaluate(g,b,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null).snapshotItem(0);if(!f){return null}var e=new URL(f.src);var a=e.pathname.replace("/","").replace("embed/","");var i=[{"@id":e.origin+e.pathname}];var h=new XMLHttpRequest();h.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var j=JSON.parse(h.responseText);j["@id"]=e.origin+e.pathname;injectJSON(JSON.stringify(j),e)}};h.open("GET",ytServer+"/schemaorg/video.json?ids="+a,true);h.send();return i},xpathExtract:function(d,c){var e=d[0];var l,i,b="",l="",f=null;if(e[ns.high+"xPath"]==undefined||e[ns.high+"xPath"][0]==undefined){return null}var m=e[ns.high+"xPath"][0].value;i=e[ns.high+"xPath"][0].value.replace(/(\/node\(\))/gi,"");if(e[ns.high+"filter"]!==undefined){b=e[ns.high+"filter"][0].value}try{var a=document.evaluate(i,c,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE);for(var k=0;k<a.snapshotLength;k++){f=a.snapshotItem(k);var h=a.snapshotItem(k);l+=Tag.getContentFromElement(h)+"\n"}}catch(j){return""}if(l!=null&&l!=""){var g=document.createElement("div");l=applyContentFilter(l,b);g.innerHTML=l;if(m.match(/\/node\(\)/)===null){l=g.innerText;l=l.replace(/\s\s+/g," ");l=Utility.convertToNumeric(Utility.encodeHtmlEntities(l))}else{l=g.innerHTML}return[l,f]}return null},storedResource:function(e){var b=e[0];if(!b[ns.high+"value"]){return}var d=b[ns.high+"value"][0].value;var a=btoa(unescape(d)).replace(/=/g,"");var f=schemaAppgetAccountId();if(f===null){return}var c=schemaCDN+f+"/"+a;if(externalResources.indexOf(d)!==-1){return[{"@id":d}]}externalResources.push(d);Tag.makeExternalRequest(c);return[{"@id":d}]},tagLookup:function(c,b,e){var d=c[0];var n,j;var a="";if(d[ns.high+"xPath-input"]){j=d[ns.high+"xPath-input"][0].value;var q=document.evaluate(j,b,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE);if(q.snapshotLength>0){n=Tag.getContentFromElement(q.snapshotItem(0))}}if(d[ns.high+"filter"]!==undefined){a=d[ns.high+"filter"][0].value}n=applyContentFilter(n,a);var k=d[ns.schema+"target"][0]["value"];var l=k.match(/{([a-zA-Z-]+)}/gm);var p={};for(var f=0;f<l.length;f++){var m=l[f].replace(/{|}/gm,"");if(sa.reserved_words[m]){p[m]=sa.reserved_words[m]}if(m=="xPath-input"){p[m]=n}}for(var o in p){if(typeof p[o]=="function"){k=k.replace(o,p[o]())}else{k=k.replace(o,p[o])}}k=k.replace(/{|}/gm,"");var h={"@context":"http://schema.org/","@type":e["@type"],"@id":e["@id"]};var g=d[ns.high+"propertyPath"][0]["value"];if(externalResources.indexOf(k)!==-1){return}externalResources.push(k);Tag.makeExternalRequest(encodeURI(k),h,g)},makeExternalRequest:function(b,a,c){var d=new XMLHttpRequest();d.onreadystatechange=function(){if(this.readyState===4&&this.status===200){if(d.responseText===""){return}if(a){insertInto(c,JSON.parse(d.responseText),a);injectJSON(JSON.stringify(a),b)}else{injectJSON(d.responseText,b)}}};d.open("GET",b,true);d.send()}};function removeScripts(b){var c=[];if(b.children){for(var a=0;a<b.children.length;a++){var d=b.children[a];removeScripts(d);if(d.localName.toLowerCase()==="script"){c.push(d)}}}for(var a=0;a<c.length;a++){b.removeChild(c[a])}}function globChecker(h,g){if(g.charAt(0)!=="/"){g="/"+g}h=h.replace(new RegExp(".+://"),"");var b=h.split("/");var c=g.split("/");for(var d=1;d<b.length;d++){var a=b[d].toLowerCase();if(c.length>d){var f=c[d].toLowerCase();if(f.length===0){continue}if(f==="*"){continue}else{if(f==="**"){return true}else{var e=f;completeMatch=false;if(f.includes("**")){e=f.replace("**","*");completeMatch=true}e=e.replace("*",".*");e="^"+e+"$";if(a.match(new RegExp(e))){if(completeMatch){return true}continue}}}if(a!==f){return false}}else{return false}}return(d>=c.length)}if(typeof document.evaluate==="function"){if(hasLocalStorage("sessionStorage")){var storedTemplates=window.sessionStorage.getItem(LOCAL_STORAGE_KEY);if(storedTemplates!==null){config=JSON.parse(storedTemplates);saDocReady(processConfig)}}if(config==null){schemaAppLoadResources()}};